<!-- Team Show Page with Unified Dark Mode -->
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200" 
     x-data="{ darkMode: $parent.darkMode }" 
     data-controller="team-substitution">

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Team Overview -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 mb-8">
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
        <div class="flex items-center space-x-4">
          <!-- Current Team (60% width) -->
          <div class="flex items-center space-x-3 flex-1">
            <span class="text-3xl"><%= @team.emoji %></span>
            <div>
              <h2 class="text-2xl font-bold text-white"><%= @team.name %></h2>
              <p class="text-blue-100 text-sm"><%= @team.conference&.upcase %> ‚Ä¢ <%= @team.division&.titleize %></p>
            </div>
          </div>
          
          <!-- Adjacent Teams (40% width) -->
          <% if @adjacent_teams&.any? %>
            <div class="flex items-center space-x-2 w-2/5">
              <% @adjacent_teams.each do |adjacent| %>
                <%= link_to team_show_path(adjacent[:team].slug), 
                    class: "group flex items-center space-x-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg px-3 py-2 transition-all duration-200 border border-white/20 hover:border-white-30 flex-1" do %>
                  <span class="text-lg filter drop-shadow-sm"><%= adjacent[:team].emoji %></span>
                  <div class="text-right flex-1">
                    <div class="text-xs text-white group-hover:text-blue-100 transition-colors leading-tight">
                      <% team_name_parts = adjacent[:team].name.split(' ') %>
                      <% if team_name_parts.length > 1 %>
                        <span class="font-normal"><%= team_name_parts[0...-1].join(' ') %></span>
                        <span class="font-bold"><%= team_name_parts.last %></span>
                      <% else %>
                        <span class="font-bold"><%= adjacent[:team].name %></span>
                      <% end %>
                    </div>
                    <div class="text-xs text-blue-100 font-medium opacity-90">
                      #<%= adjacent[:rank] %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Rankings Section -->
    <% if @teams_week %>
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8 mb-8">
      <!-- Power Rankings -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üèÜ</span>
            <div>
              <h3 class="text-xl font-bold text-white">Power</h3>
              <p class="text-purple-100 text-sm">Overall team strength</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Power Score:</span>
              <span class="font-mono font-bold text-2xl text-purple-600 dark:text-purple-400"><%= @teams_week.power_rank_score %></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Offense Score:</span>
              <span class="font-mono font-bold text-xl text-blue-600 dark:text-blue-400"><%= @teams_week.offense_score %></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Defense Score:</span>
              <span class="font-mono font-bold text-xl text-green-600 dark:text-green-400"><%= @teams_week.defense_score %></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Offense Rankings -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üèà</span>
            <div>
              <h3 class="text-xl font-bold text-white">Offense</h3>
              <p class="text-blue-100 text-sm">Offensive rankings</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-3">
            <% [
              ['üèà QB Passing', @teams_week.qb_passing_rank],
              ['ü§≤ Receivers', @teams_week.receiver_core_rank],
              ['üõ°Ô∏è Pass Block', @teams_week.pass_block_rank],
              ['üêò Rush Block', @teams_week.rush_block_rank],
              ['üèÉ Rushing', @teams_week.rushing_rank]
            ].sort_by { |_, rank| rank }.each do |label, rank| %>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600 dark:text-gray-400"><%= label %>:</span>
                <span class="font-mono text-sm font-bold text-blue-600 dark:text-blue-400"><%= rank %></span>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Defense Rankings -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üõ°Ô∏è</span>
            <div>
              <h3 class="text-xl font-bold text-white">Defense</h3>
              <p class="text-green-100 text-sm">Defensive rankings</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-3">
            <% [
              ['‚ö° Pass Rush', @teams_week.pass_rush_rank],
              ['üëÅÔ∏è Coverage', @teams_week.coverage_rank],
              ['üõë Run Defense', @teams_week.run_defense_rank]
            ].sort_by { |_, rank| rank }.each do |label, rank| %>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600 dark:text-gray-400"><%= label %>:</span>
                <span class="font-mono text-sm font-bold text-green-600 dark:text-green-400"><%= rank %></span>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Coaching Rankings -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-4">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üëî</span>
            <div>
              <h3 class="text-xl font-bold text-white">Coaching</h3>
              <p class="text-orange-100 text-sm">Coaching rankings</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-3">
            <% [
              ['üß† Play Caller', @teams_week.offensive_play_caller_rank],
              ['‚è±Ô∏è Pace', @teams_week.pace_of_play_rank],
              ['üëü Run Heavy', @teams_week.run_heavy_rank],
              ['ü•Ö Field Goal', @teams_week.field_goal_rank]
            ].sort_by { |_, rank| rank }.each do |label, rank| %>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600 dark:text-gray-400"><%= label %>:</span>
                <span class="font-mono text-sm font-bold text-orange-600 dark:text-orange-400"><%= rank %></span>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <% end %>

    <!-- Starters Section -->
    <div class="space-y-8 mb-8">
      <!-- Offense Starters -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <span class="text-2xl">üèà</span>
              <div>
                <h3 class="text-xl font-bold text-white">Offense Starters</h3>
                <p class="text-blue-100 text-sm">12 offensive players</p>
              </div>
            </div>
            <button data-action="click->team-substitution#toggleOffenseSubstitution" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
              <span data-team-substitution-target="offenseSubstitutionText">Substitute</span>
            </button>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- QB -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">QB</h4>
              <% if @teams_season&.qb_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.qb_player,
                    position: 'qb',
                    position_label: @teams_season.qb_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Pass',
                    grade1_value: @teams_season.qb_player.passing_grade_x,
                    grade1_color: 'text-blue-600',
                    grade1_dark_color: 'text-blue-400',
                    grade2_name: 'Rush',
                    grade2_value: @teams_season.qb_player.rush_grade_x,
                    grade2_color: 'text-green-600',
                    grade2_dark_color: 'text-green-400' %>
              <% else %>
                <div class="bg-gray-50 p-3 rounded-lg border border-dashed border-gray-300 text-gray-400 text-sm">
                  No QB
                </div>
              <% end %>
            </div>

            <!-- RBs -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">RB</h4>
              <% if @teams_season&.rb1_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.rb1_player,
                    position: 'rb1',
                    position_label: @teams_season.rb1_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Rush',
                    grade1_value: @teams_season.rb1_player.rush_grade_x,
                    grade1_color: 'text-green-600',
                    grade1_dark_color: 'text-green-400',
                    grade2_name: 'Off',
                    grade2_value: @teams_season.rb1_player.grades_offense || 60,
                    grade2_color: 'text-blue-600',
                    grade2_dark_color: 'text-blue-400' %>
              <% end %>
              <% if @teams_season&.rb2_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.rb2_player,
                    position: 'rb2',
                    position_label: @teams_season.rb2_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Rush',
                    grade1_value: @teams_season.rb2_player.rush_grade_x,
                    grade1_color: 'text-green-600',
                    grade1_dark_color: 'text-green-400',
                    grade2_name: 'Off',
                    grade2_value: @teams_season.rb2_player.grades_offense || 60,
                    grade2_color: 'text-blue-600',
                    grade2_dark_color: 'text-blue-400' %>
              <% end %>
            </div>

            <!-- WRs -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">WR</h4>
              <% if @teams_season&.wr1_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.wr1_player,
                    position: 'wr1',
                    position_label: @teams_season.wr1_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Route',
                    grade1_value: @teams_season.wr1_player.receiving_grade_x,
                    grade1_color: 'text-purple-600',
                    grade1_dark_color: 'text-purple-400',
                    grade2_name: 'Off',
                    grade2_value: @teams_season.wr1_player.grades_offense || 60,
                    grade2_color: 'text-blue-600',
                    grade2_dark_color: 'text-blue-400' %>
              <% end %>
              <% if @teams_season&.wr2_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.wr2_player,
                    position: 'wr2',
                    position_label: @teams_season.wr2_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Route',
                    grade1_value: @teams_season.wr2_player.receiving_grade_x,
                    grade1_color: 'text-purple-600',
                    grade1_dark_color: 'text-purple-400',
                    grade2_name: 'Off',
                    grade2_value: @teams_season.wr2_player.grades_offense || 60,
                    grade2_color: 'text-blue-600',
                    grade2_dark_color: 'text-blue-400' %>
              <% end %>
              <% if @teams_season&.wr3_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.wr3_player,
                    position: 'wr3',
                    position_label: @teams_season.wr3_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Route',
                    grade1_value: @teams_season.wr3_player.receiving_grade_x,
                    grade1_color: 'text-purple-600',
                    grade1_dark_color: 'text-purple-400',
                    grade2_name: 'Off',
                    grade2_value: @teams_season.wr3_player.grades_offense || 60,
                    grade2_color: 'text-blue-600',
                    grade2_dark_color: 'text-blue-400' %>
              <% end %>
            </div>

            <!-- TE -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">TE</h4>
              <% if @teams_season&.te_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.te_player,
                    position: 'te',
                    position_label: @teams_season.te_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Route',
                    grade1_value: @teams_season.te_player.receiving_grade_x,
                    grade1_color: 'text-purple-600',
                    grade1_dark_color: 'text-purple-400',
                    grade2_name: 'Run',
                    grade2_value: @teams_season.te_player.run_block_grade_x,
                    grade2_color: 'text-green-600',
                    grade2_dark_color: 'text-green-400' %>
              <% end %>
            </div>

            <!-- O-Line -->
            <div class="space-y-2 col-span-2 lg:col-span-4">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">Offensive Line</h4>
              <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
                <% if @teams_season&.left_tackle_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.left_tackle_player,
                      position: 'lt',
                      position_label: 'LT',
                      card_background: @teams_season.qb_player&.left_handed? ? 'bg-gray-50 dark:bg-gray-700' : 'bg-yellow-50 dark:bg-yellow-900 border-yellow-300 dark:border-yellow-600',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Pass',
                      grade1_value: @teams_season.left_tackle_player.pass_block_grade_x,
                      grade1_color: 'text-blue-600',
                      grade1_dark_color: 'text-blue-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.left_tackle_player.run_block_grade_x,
                      grade2_color: 'text-green-600',
                      grade2_dark_color: 'text-green-400' %>
                <% end %>
                <% if @teams_season&.left_guard_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.left_guard_player,
                      position: 'lg',
                      position_label: 'LG',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Pass',
                      grade1_value: @teams_season.left_guard_player.pass_block_grade_x,
                      grade1_color: 'text-blue-600',
                      grade1_dark_color: 'text-blue-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.left_guard_player.run_block_grade_x,
                      grade2_color: 'text-green-600',
                      grade2_dark_color: 'text-green-400' %>
                <% end %>
                <% if @teams_season&.center_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.center_player,
                      position: 'c',
                      position_label: 'C',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Pass',
                      grade1_value: @teams_season.center_player.pass_block_grade_x,
                      grade1_color: 'text-blue-600',
                      grade1_dark_color: 'text-blue-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.center_player.run_block_grade_x,
                      grade2_color: 'text-green-600',
                      grade2_dark_color: 'text-green-400' %>
                <% end %>
                <% if @teams_season&.right_guard_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.right_guard_player,
                      position: 'rg',
                      position_label: 'RG',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Pass',
                      grade1_value: @teams_season.right_guard_player.pass_block_grade_x,
                      grade1_color: 'text-blue-600',
                      grade1_dark_color: 'text-blue-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.right_guard_player.run_block_grade_x,
                      grade2_color: 'text-green-600',
                      grade2_dark_color: 'text-green-400' %>
                <% end %>
                <% if @teams_season&.right_tackle_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.right_tackle_player,
                      position: 'rt',
                      position_label: 'RT',
                      card_background: @teams_season.qb_player&.left_handed? ? 'bg-yellow-50 dark:bg-yellow-900 border-yellow-300 dark:border-yellow-600' : 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Pass',
                      grade1_value: @teams_season.right_tackle_player.pass_block_grade_x,
                      grade1_color: 'text-blue-600',
                      grade1_dark_color: 'text-blue-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.right_tackle_player.run_block_grade_x,
                      grade2_color: 'text-green-600',
                      grade2_dark_color: 'text-green-400' %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Defense Starters -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <span class="text-2xl">üõ°Ô∏è</span>
              <div>
                <h3 class="text-xl font-bold text-white">Defense Starters</h3>
                <p class="text-green-100 text-sm">12 defensive players</p>
              </div>
            </div>
            <button data-action="click->team-substitution#toggleDefenseSubstitution" 
                    class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
              <span data-team-substitution-target="defenseSubstitutionText">Substitute</span>
            </button>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Edge Rushers -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">Edge</h4>
              <% if @teams_season&.edge1_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.edge1_player,
                    position: 'eg1',
                    position_label: @teams_season.edge1_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Rush',
                    grade1_value: @teams_season.edge1_player.pass_rush_grade_x,
                    grade1_color: 'text-red-600',
                    grade1_dark_color: 'text-red-400',
                    grade2_name: 'Run',
                    grade2_value: @teams_season.edge1_player.rush_defense_grade_x,
                    grade2_color: 'text-orange-600',
                    grade2_dark_color: 'text-orange-400' %>
              <% end %>
              <% if @teams_season&.edge2_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.edge2_player,
                    position: 'eg2',
                    position_label: @teams_season.edge2_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Rush',
                    grade1_value: @teams_season.edge2_player.pass_rush_grade_x,
                    grade1_color: 'text-red-600',
                    grade1_dark_color: 'text-red-400',
                    grade2_name: 'Run',
                    grade2_value: @teams_season.edge2_player.rush_defense_grade_x,
                    grade2_color: 'text-orange-600',
                    grade2_dark_color: 'text-orange-400' %>
              <% end %>
            </div>

            <!-- Defensive Line -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">DL</h4>
              <% if @teams_season&.dl1_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.dl1_player,
                    position: 'dl1',
                    position_label: @teams_season.dl1_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Run',
                    grade1_value: @teams_season.dl1_player.rush_defense_grade_x,
                    grade1_color: 'text-orange-600',
                    grade1_dark_color: 'text-orange-400',
                    grade2_name: 'Rush',
                    grade2_value: @teams_season.dl1_player.pass_rush_grade_x,
                    grade2_color: 'text-red-600',
                    grade2_dark_color: 'text-red-400' %>
              <% end %>
              <% if @teams_season&.dl2_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.dl2_player,
                    position: 'dl2',
                    position_label: @teams_season.dl2_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Run',
                    grade1_value: @teams_season.dl2_player.rush_defense_grade_x,
                    grade1_color: 'text-orange-600',
                    grade1_dark_color: 'text-orange-400',
                    grade2_name: 'Rush',
                    grade2_value: @teams_season.dl2_player.pass_rush_grade_x,
                    grade2_color: 'text-red-600',
                    grade2_dark_color: 'text-red-400' %>
              <% end %>
              <% if @teams_season&.dl3_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.dl3_player,
                    position: 'dl3',
                    position_label: @teams_season.dl3_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Run',
                    grade1_value: @teams_season.dl3_player.rush_defense_grade_x,
                    grade1_color: 'text-orange-600',
                    grade1_dark_color: 'text-orange-400',
                    grade2_name: 'Rush',
                    grade2_value: @teams_season.dl3_player.pass_rush_grade_x,
                    grade2_color: 'text-red-600',
                    grade2_dark_color: 'text-red-400' %>
              <% end %>
            </div>

            <!-- Linebackers -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">LB</h4>
              <% if @teams_season&.lb1_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.lb1_player,
                    position: 'lb1',
                    position_label: @teams_season.lb1_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Run',
                    grade1_value: @teams_season.lb1_player.rush_defense_grade_x,
                    grade1_color: 'text-orange-600',
                    grade1_dark_color: 'text-orange-400',
                    grade2_name: 'Cover',
                    grade2_value: @teams_season.lb1_player.coverage_grade_x,
                    grade2_color: 'text-indigo-600',
                    grade2_dark_color: 'text-indigo-400' %>
              <% end %>
              <% if @teams_season&.lb2_player %>
                <%= render 'teams/player_card', 
                    player: @teams_season.lb2_player,
                    position: 'lb2',
                    position_label: @teams_season.lb2_player.position_symbol,
                    card_background: 'bg-gray-50 dark:bg-gray-700',
                    padding_size: 'p-4',
                    stats_alignment: 'text-right',
                    grade1_name: 'Run',
                    grade1_value: @teams_season.lb2_player.rush_defense_grade_x,
                    grade1_color: 'text-orange-600',
                    grade1_dark_color: 'text-orange-400',
                    grade2_name: 'Cover',
                    grade2_value: @teams_season.lb2_player.coverage_grade_x,
                    grade2_color: 'text-indigo-600',
                    grade2_dark_color: 'text-indigo-400' %>
              <% end %>
            </div>

            <!-- Secondary -->
            <div class="space-y-2 col-span-2 lg:col-span-4">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">Secondary</h4>
              <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
                <% if @teams_season&.cb1_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.cb1_player,
                      position: 'cb1',
                      position_label: 'CB1',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Cover',
                      grade1_value: @teams_season.cb1_player.coverage_grade_x,
                      grade1_color: 'text-indigo-600',
                      grade1_dark_color: 'text-indigo-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.cb1_player.rush_defense_grade_x,
                      grade2_color: 'text-orange-600',
                      grade2_dark_color: 'text-orange-400' %>
                <% end %>
                <% if @teams_season&.cb2_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.cb2_player,
                      position: 'cb2',
                      position_label: 'CB2',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Cover',
                      grade1_value: @teams_season.cb2_player.coverage_grade_x,
                      grade1_color: 'text-indigo-600',
                      grade1_dark_color: 'text-indigo-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.cb2_player.rush_defense_grade_x,
                      grade2_color: 'text-orange-600',
                      grade2_dark_color: 'text-orange-400' %>
                <% end %>
                <% if @teams_season&.cb3_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.cb3_player,
                      position: 'cb3',
                      position_label: 'CB3',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Cover',
                      grade1_value: @teams_season.cb3_player.coverage_grade_x,
                      grade1_color: 'text-indigo-600',
                      grade1_dark_color: 'text-indigo-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.cb3_player.rush_defense_grade_x,
                      grade2_color: 'text-orange-600',
                      grade2_dark_color: 'text-orange-400' %>
                <% end %>
                <% if @teams_season&.safety1_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.safety1_player,
                      position: 's1',
                      position_label: 'S1',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Cover',
                      grade1_value: @teams_season.safety1_player.coverage_grade_x,
                      grade1_color: 'text-indigo-600',
                      grade1_dark_color: 'text-indigo-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.safety1_player.rush_defense_grade_x,
                      grade2_color: 'text-orange-600',
                      grade2_dark_color: 'text-orange-400' %>
                <% end %>
                <% if @teams_season&.safety2_player %>
                  <%= render 'teams/player_card', 
                      player: @teams_season.safety2_player,
                      position: 's2',
                      position_label: 'S2',
                      card_background: 'bg-gray-50 dark:bg-gray-700',
                      padding_size: 'p-3',
                      stats_alignment: 'text-left md:text-right',
                      grade1_name: 'Cover',
                      grade1_value: @teams_season.safety2_player.coverage_grade_x,
                      grade1_color: 'text-indigo-600',
                      grade1_dark_color: 'text-indigo-400',
                      grade2_name: 'Run',
                      grade2_value: @teams_season.safety2_player.rush_defense_grade_x,
                      grade2_color: 'text-orange-600',
                      grade2_dark_color: 'text-orange-400' %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Coaching Staff Section -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 mb-8">
        <div class="bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üëî</span>
            <div>
              <h3 class="text-xl font-bold text-white">Coaching Staff</h3>
              <p class="text-purple-100 text-sm">Head Coach, Offensive & Defensive Coordinators</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Head Coach -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">Head Coach</h4>
              <% if @teams_season&.head_coach %>
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-600">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <div class="flex items-center space-x-1 mb-1">
                        <span class="text-xs text-gray-600 dark:text-gray-400"><%= @teams_season.head_coach.first_name %></span>
                        <span class="font-bold text-sm text-gray-900 dark:text-white"><%= @teams_season.head_coach.last_name %></span>
                      </div>
                    </div>
                    <div class="text-xs text-purple-600 dark:text-purple-400 font-medium">
                      <% if @teams_season.offensive_play_caller == @teams_season.head_coach&.slug %>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-xs">Offense Play Caller</span>
                      <% elsif @teams_season.defensive_play_caller == @teams_season.head_coach&.slug %>
                        <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded text-xs">Defense Play Caller</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% else %>
                <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-600 text-gray-400 dark:text-gray-500 text-sm">
                  No Head Coach
                </div>
              <% end %>
            </div>

            <!-- Offensive Coordinator -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">Offensive Coordinator</h4>
              <% if @teams_season&.offensive_coordinator %>
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-600">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <div class="flex items-center space-x-1 mb-1">
                        <span class="text-xs text-gray-600 dark:text-gray-400"><%= @teams_season.offensive_coordinator.first_name %></span>
                        <span class="font-bold text-sm text-gray-900 dark:text-white"><%= @teams_season.offensive_coordinator.last_name %></span>
                      </div>
                    </div>
                    <div class="text-xs text-blue-600 dark:text-blue-400 font-medium">
                      <% if @teams_season.offensive_play_caller == @teams_season.offensive_coordinator&.slug %>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-xs">Offense Play Caller</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% else %>
                <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-600 text-gray-400 dark:text-gray-500 text-sm">
                  No OC
                </div>
              <% end %>
            </div>

            <!-- Defensive Coordinator -->
            <div class="space-y-2">
              <h4 class="font-semibold text-gray-700 dark:text-gray-300 text-sm">Defensive Coordinator</h4>
              <% if @teams_season&.defensive_coordinator %>
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-600">
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <div class="flex items-center space-x-1 mb-1">
                        <span class="text-xs text-gray-600 dark:text-gray-400"><%= @teams_season.defensive_coordinator.first_name %></span>
                        <span class="font-bold text-sm text-gray-900 dark:text-white"><%= @teams_season.defensive_coordinator.last_name %></span>
                      </div>
                    </div>
                    <div class="text-xs text-green-600 dark:text-green-400 font-medium">
                      <% if @teams_season.defensive_play_caller == @teams_season.defensive_coordinator&.slug %>
                        <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded text-xs">Defense Play Caller</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% else %>
                <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-600 text-gray-400 dark:text-gray-500 text-sm">
                  No DC
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

    <!-- Bench Players Section -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 mb-8">
      <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">ü™ë</span>
            <div>
              <h3 class="text-xl font-bold text-white">Bench Players</h3>
              <p class="text-orange-100 text-sm">Available substitutes</p>
            </div>
          </div>
          <button data-action="click->team-substitution#toggleBench" 
                  class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm transition-colors">
            <span data-team-substitution-target="benchToggleText">Show Bench</span>
          </button>
        </div>
      </div>
      <div class="p-6" data-team-substitution-target="benchContent" style="display: none; min-height: 400px;">
        <!-- Filters -->
        <div class="mb-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Search -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
              <input type="text" 
                     data-team-substitution-target="benchSearch"
                     data-action="input->team-substitution#filterBenchPlayers"
                     placeholder="Player name..."
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            
            <!-- Position Filter -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
              <select data-team-substitution-target="benchPositionFilter"
                      data-action="change->team-substitution#filterBenchPlayers"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">All Positions</option>
                <option value="quarterback">Quarterback</option>
                <option value="running-back">Running Back</option>
                <option value="wide-receiver">Wide Receiver</option>
                <option value="tight-end">Tight End</option>
                <option value="center">Center</option>
                <option value="gaurd">Guard</option>
                <option value="tackle">Tackle</option>
                <option value="edge-rusher">Edge Rusher</option>
                <option value="defensive-end">Defensive End</option>
                <option value="linebacker">Linebacker</option>
                <option value="cornerback">Cornerback</option>
                <option value="safety">Safety</option>
                <option value="place-kicker">Place Kicker</option>
                <option value="punter">Punter</option>
              </select>
            </div>
            
            <!-- Grade Filter -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Min Grade</label>
              <select data-team-substitution-target="benchGradeFilter"
                      data-action="change->team-substitution#filterBenchPlayers"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">All Grades</option>
                <option value="90">90+</option>
                <option value="85">85+</option>
                <option value="80">80+</option>
                <option value="75">75+</option>
                <option value="70">70+</option>
                <option value="65">65+</option>
                <option value="60">60+</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Bench Players Table -->
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200" data-team-substitution-target="benchTable">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Player</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grades</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% @bench_by_position.values.flatten.each do |player| %>
                <tr class="hover:bg-gray-50 transition-colors"
                    data-player-name="<%= player.full_name.downcase %>"
                    data-position="<%= player.position %>"
                    data-grade="<%= player.grades_offense || 60 %>">
                  <!-- Player Name -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div class="flex-shrink-0">
                        <div class="text-sm font-medium text-gray-900">
                          <span class="text-gray-600 text-xs"><%= player.first_name %></span>
                          <span class="font-bold"><%= player.last_name %></span>
                        </div>
                      </div>
                    </div>
                  </td>
                  
                  <!-- Position -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      <%= player.position_symbol %>
                    </span>
                  </td>
                  
                  <!-- Grades -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-xs font-mono space-y-1">
                      <% case player.position %>
                      <% when 'quarterback' %>
                        <div class="text-blue-600">Pass: <%= player.passing_grade_x %></div>
                      <% when 'running-back' %>
                        <div class="text-green-600">Rush: <%= player.rush_grade_x %></div>
                      <% when 'wide-receiver', 'tight-end' %>
                        <div class="text-purple-600">Route: <%= player.receiving_grade_x %></div>
                      <% when 'center', 'gaurd', 'tackle' %>
                        <div class="text-blue-600">Pass: <%= player.pass_block_grade_x %></div>
                        <div class="text-green-600">Run: <%= player.run_block_grade_x %></div>
                      <% when 'edge-rusher' %>
                        <div class="text-red-600">Rush: <%= player.pass_rush_grade_x %></div>
                      <% when 'defensive-end' %>
                        <div class="text-orange-600">Run: <%= player.rush_defense_grade_x %></div>
                      <% when 'linebacker' %>
                        <div class="text-orange-600">Run: <%= player.rush_defense_grade_x %></div>
                      <% when 'cornerback', 'safety' %>
                        <div class="text-indigo-600">Cover: <%= player.coverage_grade_x %></div>
                      <% else %>
                        <div class="text-gray-600">Off: <%= player.grades_offense || 60 %></div>
                      <% end %>
                    </div>
                  </td>
                  
                  <!-- Action -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <button data-action="click->team-substitution#selectPlayerForSubstitution"
                            data-player-slug="<%= player.slug %>"
                            data-position=""
                            class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                      Substitute
                    </button>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        
        <!-- Results Count -->
        <div class="mt-4 text-sm text-gray-600">
          <span data-team-substitution-target="benchCount">0 players found</span>
        </div>
      </div>
    </div>

    <!-- Substitution Modal -->
    <div data-team-substitution-target="substitutionModal"
         data-team-substitution-show-substitution-modal-class="hidden"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-bold mb-4">Substitute Player</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Current Player</label>
            <div class="bg-gray-50 p-3 rounded border">
              <div class="font-medium" data-team-substitution-target="selectedPlayerName"></div>
              <div class="text-sm text-gray-500" data-team-substitution-target="selectedPlayerPosition"></div>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
            <div class="bg-blue-50 p-3 rounded border">
              <div class="font-medium" data-team-substitution-target="selectedPosition"></div>
            </div>
          </div>
          <div class="flex space-x-3">
            <button data-action="click->team-substitution#closeSubstitutionModal" 
                    class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded transition-colors">
              Cancel
            </button>
            <button data-action="click->team-substitution#confirmSubstitution" 
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Initialize bench player count on page load
    document.addEventListener('DOMContentLoaded', function() {
      const controller = document.querySelector('[data-controller="team-substitution"]').stimulus
      if (controller) {
        controller.filterBenchPlayers()
      }
    })
  </script>
</div> 