<!-- Player Card Template -->
<% 
  # Define grade configurations
  grade_configs = {
    'passing' => { name: 'Pass 🏈', color: 'text-green-600', dark_color: 'text-green-400', value: player.passing_grade_x },
    'rushing' => { name: 'Rush 🏃', color: 'text-purple-600', dark_color: 'text-purple-400', value: player.rush_grade_x },
    'receiving' => { name: 'Route 🤲', color: 'text-green-600', dark_color: 'text-green-400', value: player.receiving_grade_x },
    'pass_block' => { name: 'Pass 🛡️', color: 'text-green-600', dark_color: 'text-green-400', value: player.pass_block_grade_x },
    'run_block' => { name: 'Run 🛡️', color: 'text-purple-600', dark_color: 'text-purple-400', value: player.run_block_grade_x },
    'pass_rush' => { name: 'Pass Rush 🔥', color: 'text-green-600', dark_color: 'text-green-400', value: player.pass_rush_grade_x },
    'rush_defense' => { name: 'Run Def 🛑', color: 'text-red-600', dark_color: 'text-red-400', value: player.rush_defense_grade_x },
    'coverage' => { name: 'Cover 🔒', color: 'text-green-600', dark_color: 'text-green-400', value: player.coverage_grade_x },
    'grades_offense' => { name: 'Offense', color: 'text-blue-600', dark_color: 'text-blue-400', value: player.grades_offense || 60 },
    'grades_defence' => { name: 'Defense', color: 'text-indigo-600', dark_color: 'text-indigo-400', value: player.grades_defence || 60 }
  }
  
  # Helper method for ordinal suffixes
  def ordinal_suffix(number)
    return 'th' if [11, 12, 13].include?(number % 100)
    case number % 10
    when 1 then 'st'
    when 2 then 'nd'
    when 3 then 'rd'
    else 'th'
    end
  end
  
  # Calculate years in league
  current_year = Date.current.year
  if player.rookie_year.to_i > 1
    years_in_league = player.rookie_year ? current_year - player.rookie_year : nil
  else
    years_in_league = 0
  end 
  
  # Determine if they played last season
  snaps_last_season = (player.snaps_on_offense || player.snaps_on_defence).to_i
  played_last_season = (snaps_last_season > 500)
  
  # Determine card background based on highlight
  card_bg = if highlight
    'bg-yellow-50 dark:bg-yellow-900 border-yellow-300 dark:border-yellow-600'
  else
    'bg-gray-50 dark:bg-gray-700'
  end
  
  # Determine padding size
  padding = size == 'small' ? 'p-3' : 'p-4'
%>
<div class="<%= card_bg %> <%= padding %> rounded-lg border dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
     @click="selectPlayerForSubstitution('<%= player.slug %>', '<%= defined?(position) ? position : '' %>')">
  <div class="flex justify-between items-start">
    <div class="flex-1">
      <% if size == 'small' %>
        <div class="mb-1">
          <div class="text-xs text-gray-600 dark:text-gray-400"><%= player.first_name %></div>
          <div class="font-bold text-sm text-gray-900 dark:text-white"><%= player.last_name %></div>
        </div>
      <% else %>
        <div class="flex items-center space-x-1 mb-1">
          <span class="text-xs text-gray-600 dark:text-gray-400"><%= player.first_name %></span>
          <span class="font-bold text-sm text-gray-900 dark:text-white"><%= player.last_name %></span>
        </div>
      <% end %>
      <% 
        # Check if expected_position is defined and different from player's position
        position_mismatch = defined?(expected_position) && expected_position.present? && player.position != expected_position
        position_classes = if position_mismatch
          'text-xs font-bold text-red-600 dark:text-red-400'
        else
          'text-xs text-gray-500 dark:text-gray-400'
        end
      %>
      <div class="<%= position_classes %>"><%= player.position %> <%= "😵‍💫" if position_mismatch %></div>
      <% if years_in_league > 0 %>
        <div class="text-xs text-gray-500 dark:text-gray-400">
          <%= years_in_league+1 %><%= ordinal_suffix(years_in_league+1) %> Season
        </div>
      <% else %>
        <div class="text-xs text-orange-500 dark:text-orange-400">
          Rookie 👶 
        </div> 
      <% end %>
    </div>
    <div class="text-xs font-mono text-right space-y-1">
      <% grades.each do |grade_slug| %>
        <% if grade_configs[grade_slug] && grade_configs[grade_slug][:value] %>
          <div class="<%= grade_configs[grade_slug][:color] %> dark:<%= grade_configs[grade_slug][:dark_color] %>">
            <%= grade_configs[grade_slug][:name] %>: <%= grade_configs[grade_slug][:value] %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  
  <% if (years_in_league == 0) || (player.correction.present?) %>
    <!-- Tenure Section - Full Width -->
    <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-600">
      
        <div class="flex justify-between items-center">
          <div class="text-xs text-gray-500 dark:text-gray-400">
            <%= player.correction %> 📊
          </div>
        </div>
      
    </div>
  <% end %>
  <% if years_in_league > 0 && !played_last_season %>
    <div class="text-xs mt-2 pt-2 border-t border-gray-200 dark:border-gray-600 <%= played_last_season ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400' %>">        
    <%= played_last_season ? '' : "#{snaps_last_season} snaps in 2024" %>
    </div>
  <% end %>
</div> 