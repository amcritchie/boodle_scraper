<!-- Offensive Lineup Card -->
<div class="bg-white dark:bg-[#1a2d24] rounded-2xl shadow-2xl overflow-hidden border border-[#4BAF50]/20">
  <div class="bg-gradient-to-r from-[#4BAF50] to-[#3d8a40] px-6 py-4">
    <div class="flex items-center space-x-3">
      <span class="text-2xl"><%= matchup.team.emoji %> </span>
      <h3 class="text-xl text-white"><%= matchup.team.location %> <span class="font-bold">Offense</span></h3>
    </div>
  </div>
  
  <div class="p-6">
    <!-- Pass Blocking and Run Blocking Ranks -->
    <div class="mb-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="text-left p-3 rounded-lg <%= (matchup.pass_block_rank&.between?(1, 9) ? 'bg-[#4BAF50] dark:bg-[#4BAF50] text-white' : 'bg-[#E8F0E6] dark:bg-[#121E18]') %>">
          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold w-8 text-center <%= (matchup.pass_block_rank&.between?(1, 9) ? 'text-white' : 'text-[#4BAF50]') %>"><%= matchup.pass_block_rank || 'N/A' %></span>
            <span class="text-sm <%= (matchup.pass_block_rank&.between?(1, 9) ? 'text-white/90' : 'text-[#A5B1AA]') %>">Pass Block Rank</span>
          </div>
        </div>
        <div class="text-left p-3 rounded-lg <%= (matchup.rush_block_rank&.between?(1, 9) ? 'bg-[#4BAF50] dark:bg-[#4BAF50] text-white' : 'bg-[#E8F0E6] dark:bg-[#121E18]') %>">
          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold w-8 text-center <%= (matchup.rush_block_rank&.between?(1, 9) ? 'text-white' : 'text-[#4BAF50]') %>"><%= matchup.rush_block_rank || 'N/A' %></span>
            <span class="text-sm <%= (matchup.rush_block_rank&.between?(1, 9) ? 'text-white/90' : 'text-[#A5B1AA]') %>">Run Block Rank</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Offensive Line -->
    <!-- Rankings now use stored data from Ranking model when available, fallback to live calculation -->
    <div class="mb-4">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
        <% if matchup.left_tackle_player %>
          <% lt_ranking = matchup.left_tackle_player.olinemen_ranking %>
          <%= render 'matchups/player_card', 
              player: matchup.left_tackle_player,
              position: 'LT', 
              rank: lt_ranking&.rank_for_category('pass_block'),
              sample_size: lt_ranking&.sample_size,
              percentile: lt_ranking&.percentile_for_category('pass_block'),
              highlight: !matchup.qb_player&.left_handed?,
              link: "/nfl-offensive-line-rankings?team=#{matchup.team.alias}" %>
        <% end %>
        
        <% if matchup.left_guard_player %>
          <% lg_ranking = matchup.left_guard_player.olinemen_ranking %>
          <%= render 'matchups/player_card', 
              player: matchup.left_guard_player,
              position: 'LG', 
              rank: lg_ranking&.rank_for_category('pass_block'),
              sample_size: lg_ranking&.sample_size,
              percentile: lg_ranking&.percentile_for_category('pass_block'),
              highlight: false,
              link: "/nfl-offensive-line-rankings?team=#{matchup.team.alias}" %>
        <% end %>
        
        <% if matchup.center_player %>
          <% c_ranking = matchup.center_player.olinemen_ranking %>
          <%= render 'matchups/player_card', 
              player: matchup.center_player,
              position: 'C', 
              rank: c_ranking&.rank_for_category('pass_block'),
              sample_size: c_ranking&.sample_size,
              percentile: c_ranking&.percentile_for_category('pass_block'),
              highlight: false,
              link: "/nfl-offensive-line-rankings?team=#{matchup.team.alias}" %>
        <% end %>
        
        <% if matchup.right_guard_player %>
          <% rg_ranking = matchup.right_guard_player.olinemen_ranking %>
          <%= render 'matchups/player_card', 
              player: matchup.right_guard_player,
              position: 'RG', 
              rank: rg_ranking&.rank_for_category('pass_block'),
              sample_size: rg_ranking&.sample_size,
              percentile: rg_ranking&.percentile_for_category('pass_block'),
              highlight: false,
              link: "/nfl-offensive-line-rankings?team=#{matchup.team.alias}" %>
        <% end %>
        
        <% if matchup.right_tackle_player %>
          <% rt_ranking = matchup.right_tackle_player.olinemen_ranking %>
          <%= render 'matchups/player_card', 
              player: matchup.right_tackle_player,
              position: 'RT', 
              rank: rt_ranking&.rank_for_category('pass_block'),
              sample_size: rt_ranking&.sample_size,
              percentile: rt_ranking&.percentile_for_category('pass_block'),
              highlight: matchup.qb_player&.left_handed?,
              link: "/nfl-offensive-line-rankings?team=#{matchup.team.alias}" %>
        <% end %>
      </div>
    </div>
    
    <!-- Passing and Rushing Ranks -->
    <div class="mb-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="text-left p-3 rounded-lg <%= (matchup.passing_attack_rank&.between?(1, 9) ? 'bg-[#4BAF50] dark:bg-[#4BAF50] text-white' : 'bg-[#E8F0E6] dark:bg-[#121E18]') %>">
          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold w-8 text-center <%= (matchup.passing_attack_rank&.between?(1, 9) ? 'text-white' : 'text-[#4BAF50]') %>"><%= matchup.passing_attack_rank || 'N/A' %></span>
            <span class="text-sm <%= (matchup.passing_attack_rank&.between?(1, 9) ? 'text-white/90' : 'text-[#A5B1AA]') %>">Passing Rank</span>
          </div>
        </div>
        <div class="text-left p-3 rounded-lg <%= (matchup&.rushing_attack_rank&.between?(1, 9) ? 'bg-[#4BAF50] dark:bg-[#4BAF50] text-white' : 'bg-[#E8F0E6] dark:bg-[#121E18]') %>">
          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold w-8 text-center <%= (matchup&.rushing_attack_rank&.between?(1, 9) ? 'text-white' : 'text-[#4BAF50]') %>"><%= matchup&.rushing_attack_rank || 'N/A' %></span>
            <span class="text-sm <%= (matchup&.rushing_attack_rank&.between?(1, 9) ? 'text-white/90' : 'text-[#A5B1AA]') %>">Rushing Rank</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Quarterback and RB1 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <% if matchup.qb_player %>
        <%= render 'matchups/player_card', 
            player: matchup.qb_player,
            position: 'Quarterback', 
            rank: matchup.qb_player.pass_rank %>
      <% end %>
      
      <% if matchup.rb1_player %>
        <%= render 'matchups/player_card', 
            player: matchup.rb1_player,
            position: 'Running Back', 
            rank: matchup.rb1_player.run_rank %>
      <% end %>
    </div>
    
    <!-- Receiving Rank -->
    <div class="mb-4">
      <div class="flex items-center justify-start">
        <div class="text-left p-3 rounded-lg w-full <%= (matchup&.receiver_core_rank&.between?(1, 9) ? 'bg-[#4BAF50] dark:bg-[#4BAF50] text-white' : 'bg-[#E8F0E6] dark:bg-[#121E18]') %>">
          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold w-8 text-center <%= (matchup&.receiver_core_rank&.between?(1, 9) ? 'text-white' : 'text-[#4BAF50]') %>"><%= matchup&.receiver_core_rank || 'N/A' %></span>
            <span class="text-sm <%= (matchup&.receiver_core_rank&.between?(1, 9) ? 'text-white/90' : 'text-[#A5B1AA]') %>">Receiving Rank</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Receivers -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <% if matchup.wr1_player %>
        <%= render 'matchups/player_card', 
            player: matchup.wr1_player,
            position: 'Receiver', 
            rank: matchup.wr1_player.pass_route_rank %>
      <% end %>
      
      <% if matchup.wr2_player %>
        <%= render 'matchups/player_card', 
            player: matchup.wr2_player,
            position: 'Receiver', 
            rank: matchup.wr2_player.pass_route_rank %>
      <% end %>
      
      <% if matchup.wr3_player %>
        <%= render 'matchups/player_card', 
            player: matchup.wr3_player,
            position: 'Receiver', 
            rank: matchup.wr3_player.pass_route_rank %>
      <% end %>
    </div>
    
    <!-- Tight End and RB2 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <% if matchup.te_player %>
        <%= render 'matchups/player_card', 
            player: matchup.te_player,
            position: 'Tight End', 
            rank: matchup.te_player.pass_route_rank %>
      <% end %>
      
      <% if matchup.rb2_player %>
        <%= render 'matchups/player_card', 
            player: matchup.rb2_player,
            position: 'Running Back', 
            rank: matchup.rb2_player.run_rank %>
      <% end %>
    </div>
  </div>
</div>
