<% highlight ||= false %>
<% sample_size ||= nil %>
<% percentile ||= nil %>
<% player ||= nil %>
<% link ||= nil %>
<% 
  # Extract first_name and last_name from player object if provided
  if player
    first_name ||= player.first_name
    last_name ||= player.last_name
  end
%>
<% 
  # Use percentile if available, otherwise calculate from rank and sample_size
  rank_color_class = if percentile
    # Use the already calculated percentile from the ranking model
    case percentile
    when 0..25
      'text-red-600 dark:text-red-400'     # Bottom 25% - poor
    when 25..50
      'text-yellow-500'                     # 25-50% - average
    when 50..75
      'text-green-500'                      # 50-75% - good  
    else
      'text-green-600 dark:text-green-400' # Top 25% - excellent
    end
  elsif rank && sample_size && sample_size > 0
    # Fallback to manual calculation
    percentage = (rank.to_f / sample_size.to_f) * 100
    case percentage
    when 0..25
      'text-green-600 dark:text-green-400'  # Top 25% - excellent
    when 25..50
      'text-green-500'                      # Top 50% - good
    when 50..75
      'text-yellow-500'                     # Top 75% - average
    else
      'text-red-500'                        # Bottom 25% - poor
    end
  elsif rank && rank.between?(1, 10)
    'text-green-500'                        # Fallback for old logic
  else
    'text-orange-500'                       # No rank or poor rank
  end
%>
<% if link %>
  <%= link_to link, class: "block group", target: "_blank", rel: "noopener" do %>
    <div class="p-3 <%= highlight ? 'bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400' : 'bg-[#E8F0E6] dark:bg-[#121E18]' %> rounded-lg hover:bg-[#D5E7D3] dark:hover:bg-[#1a2d1f] hover:shadow-lg hover:shadow-[#4BAF50]/20 hover:border-[#4BAF50]/40 border border-transparent transition-all duration-300 ease-out cursor-pointer">
      <div class="flex justify-between items-center text-xs text-[#A5B1AA] group-hover:text-[#4BAF50] transition-colors duration-300">
        <span class="font-medium"><%= position %></span>
        <span class="w-10 text-right px-0 py-.5 text-xs font-bold <%= rank_color_class %> transition-colors duration-300">
          <%= rank || 'N/A' %>
        </span>
      </div>
      <div class="text-xs text-[#121E18] dark:text-[#E8F0E6] leading-tight truncate group-hover:text-[#4BAF50] dark:group-hover:text-[#4BAF50] transition-colors duration-300">
        <%= first_name %>
      </div>
      <div class="text-xs font-bold text-[#121E18] dark:text-[#E8F0E6] leading-tight truncate group-hover:text-[#4BAF50] dark:group-hover:text-[#4BAF50] transition-colors duration-300">
        <%= last_name %>
      </div>
    </div>
  <% end %>
<% else %>
  <div class="p-3 <%= highlight ? 'bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400' : 'bg-[#E8F0E6] dark:bg-[#121E18]' %> rounded-lg">
    <div class="flex justify-between items-center text-xs text-[#A5B1AA]">
      <span><%= position %></span>
      <span class="w-10 text-right px-0 py-.5 text-xs font-medium <%= rank_color_class %>">
        <%= rank || 'N/A' %>
      </span>
    </div>
    <div class="text-xs text-[#121E18] dark:text-[#E8F0E6] leading-tight truncate">
      <%= first_name %>
    </div>
    <div class="text-xs font-bold text-[#121E18] dark:text-[#E8F0E6] leading-tight truncate">
      <%= last_name %>
    </div>
  </div>
<% end %>
